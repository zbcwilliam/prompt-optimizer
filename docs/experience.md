# é¡¹ç›®ç»éªŒæ€»ç»“ï¼ˆä¼˜åŒ–ç‰ˆï¼‰  

## ğŸ“‹ å¿«é€Ÿç´¢å¼•  
- [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)  
- [é”™è¯¯å¤„ç†](#é”™è¯¯å¤„ç†)  
- [æµ‹è¯•è§„èŒƒ](#æµ‹è¯•è§„èŒƒ)  
- [Vueå¼€å‘](#vueå¼€å‘)  
- [å·¥å…·ä¸é…ç½®](#å·¥å…·ä¸é…ç½®)  
- [å…³é”®é‡æ„ç»éªŒ](#å…³é”®é‡æ„ç»éªŒ)  
- [APIå¯†é’¥ç®¡ç†ç»éªŒ](#apiå¯†é’¥ç®¡ç†ç»éªŒ)  
- [è‡ªå®šä¹‰APIé›†æˆç»éªŒ](#è‡ªå®šä¹‰APIé›†æˆç»éªŒ)  

---

## æ¶æ„è®¾è®¡  

### APIé›†æˆè§„èŒƒ  
1. **é…ç½®åˆ†ç¦»**  
   - ä¸šåŠ¡é€»è¾‘ä¸APIé…ç½®è§£è€¦  
   - ç»Ÿä¸€æ¥å£æ ¼å¼ï¼ˆOpenAIå…¼å®¹ï¼‰  
   - ç‹¬ç«‹ç®¡ç†æç¤ºè¯æ¨¡æ¿  
   ```js
   // é…ç½®ç¤ºä¾‹
   export default {
     baseURL: "https://api.openai.com/v1",
     models: ["gpt-4", "gpt-3.5"]
   }
   ```

2. **æ¨¡å—åŒ–ç»“æ„**  
   ```src
   â”œâ”€ api/       # APIå°è£…
   â”œâ”€ services/  # ä¸šåŠ¡é€»è¾‘
   â”œâ”€ config/    # å…¨å±€é…ç½®
   â”œâ”€ components/# UIç»„ä»¶
   â””â”€ prompts/   # æç¤ºæ¨¡æ¿åº“
   ```

### LLMæœåŠ¡æ¶æ„  
| è®¾è®¡è¦ç‚¹          | å®ç°æ–¹æ¡ˆ                     |
|-------------------|----------------------------|
| æ¥å£æ ‡å‡†åŒ–        | ç»Ÿä¸€ä½¿ç”¨OpenAIæ ¼å¼          |
| å¤šæœåŠ¡å•†å…¼å®¹      | Provideræ ‡è¯†åŒºåˆ†ï¼ˆå¦‚Geminiï¼‰|
| åŠ¨æ€é…ç½®æ›´æ–°      | æ”¯æŒçƒ­åŠ è½½é…ç½®              |
| æ•æ„Ÿä¿¡æ¯ç®¡ç†      | ç¯å¢ƒå˜é‡+æœ¬åœ°åŠ å¯†å­˜å‚¨       |

---

## é”™è¯¯å¤„ç†  

### å…¸å‹é—®é¢˜ä¸ä¿®å¤  
| é—®é¢˜åœºæ™¯                  | è§£å†³æ–¹æ¡ˆ                     | å‘ç”Ÿæ—¥æœŸ   |
|--------------------------|----------------------------|------------|
| æ¨¡æ¿IDä¸æ¨¡å‹Keyæ··æ·†       | æ˜ç¡®åŠŸèƒ½IDä¸API Keyåˆ†ç¦»     | 2024-03-22 |
| çŠ¶æ€åŒæ­¥å¼‚å¸¸              | å¢åŠ çŠ¶æ€åŒæ­¥å¤„ç†å‡½æ•°        | 2024-03-22 |
| å…¨å±€currentProvideræ±¡æŸ“   | æ˜¾å¼ä¼ é€’æ¨¡å‹å‚æ•°            | 2024-03-22 |

### å¤„ç†åŸåˆ™  
1. **å¼€å‘ç¯å¢ƒ**ï¼šä¿ç•™å®Œæ•´é”™è¯¯å †æ ˆ  
2. **ç”Ÿäº§ç¯å¢ƒ**ï¼šå‹å¥½æç¤º+æ—¥å¿—è®°å½•  
3. **é€šç”¨è§„åˆ™**ï¼š  
   ```js
   try {
     await apiCall();
   } catch (err) {
     console.error("[API Error]", err.context);
     throw new Error("æœåŠ¡è°ƒç”¨å¤±è´¥ï¼Œè¯·æ£€æŸ¥é…ç½®");
   }
   ```

---

## æµ‹è¯•è§„èŒƒ  

### æ ¸å¿ƒè¦ç‚¹  
1. **ç¯å¢ƒå˜é‡**  
   ```js
   // Viteé¡¹ç›®å¿…é¡»ä½¿ç”¨import.meta.env
   const apiKey = import.meta.env.VITE_GEMINI_KEY; 
   ```

2. **æµ‹è¯•æ¶æ„**  
   - é›†ä¸­ç®¡ç†å¤šæœåŠ¡å•†é…ç½®  
   - ç‹¬ç«‹æµ‹è¯•æ•°æ®åº“  
   - æ¨¡æ‹Ÿå¼‚å¸¸åœºæ™¯ï¼ˆç½‘ç»œé”™è¯¯/æ— æ•ˆTokenï¼‰  

3. **ç”¨ä¾‹è®¾è®¡**  
   ```js
   describe("APIæµ‹è¯•", () => {
     it("åº”æ­£ç¡®å¤„ç†å¤šè½®å¯¹è¯", async () => {
       const response = await sendRequest(messages);
       expect(response.content).toMatch(/ä¼˜åŒ–å»ºè®®/);
     });
   });
   ```

---

## Vueå¼€å‘  

### ç»„ä»¶è§„èŒƒ  
1. **Composableä½¿ç”¨**  
   ```js
   // æ­£ç¡®ç”¨æ³•
   const { data } = useFetch();
   // é”™è¯¯ç”¨æ³•
   onMounted(() => {
     const { data } = useFetch(); // ç¦æ­¢åœ¨ç”Ÿå‘½å‘¨æœŸå†…è°ƒç”¨
   });
   ```

2. **çŠ¶æ€åŒæ­¥æ–¹æ¡ˆ**  
   ```vue
   <!-- çˆ¶ç»„ä»¶ -->
   <ModelManager @update="handleModelUpdate" />

   <!-- å­ç»„ä»¶ -->
   <script setup>
   const emit = defineEmits(['update']);
   const updateModel = () => {
     emit('update', newModels);
   }
   </script>
   ```

### UIè®¾è®¡å‡†åˆ™  
| åˆ†ç±»        | è§„èŒƒ                          |
|------------|------------------------------|
| å¸ƒå±€ç³»ç»Ÿ    | åŸºäºTailwindçš„å“åº”å¼ç½‘æ ¼       |
| ä¸»é¢˜ç®¡ç†    | CSSå˜é‡+é€æ˜åº¦å±‚çº§æ§åˆ¶         |
| äº¤äº’åé¦ˆ    | åŠ è½½çŠ¶æ€/ç¦ç”¨çŠ¶æ€/è¿‡æ¸¡åŠ¨ç”»      |

---

## å·¥å…·ä¸é…ç½®  

### NPMç®¡ç†  
```bash
# å¸¸ç”¨å‘½ä»¤
npm outdated          # æ£€æŸ¥å¯æ›´æ–°åŒ…
ncu -u "eslint*"      # å®‰å…¨æ›´æ–°æŒ‡å®šåŒ…
```

### ç‰ˆæœ¬ç­–ç•¥  
| ç¬¦å· | å«ä¹‰                | ç¤ºä¾‹          |
|------|---------------------|---------------|
| ^    | å…è®¸å°ç‰ˆæœ¬æ›´æ–°       | ^1.2.3 â†’ 1.3.0|
| ~    | ä»…å…è®¸è¡¥ä¸æ›´æ–°       | ~1.2.3 â†’ 1.2.4|

### YAMLå¤„ç†  
1. **å¸¸è§é”™è¯¯**  
   ```yaml
   # é”™è¯¯ç¤ºä¾‹
   -invalid: ç¼ºå°‘ç©ºæ ¼
   tags: 
     -test  # åˆ—è¡¨æ ¼å¼é”™è¯¯
   ```
   
2. **ä¿®å¤æ–¹æ¡ˆ**  
   ```yaml
   # æ­£ç¡®æ ¼å¼
   valid_key: "å€¼"
   tags:
     - test
     - template
   ```

---

## å…³é”®é‡æ„ç»éªŒ  

### æœåŠ¡å±‚ä¼˜åŒ–ï¼ˆ2024-03-19ï¼‰  
1. **ç±»å‹å®‰å…¨**  
   ```ts
   interface ModelConfig {
     name: string;
     baseURL: string;  // éå¯é€‰å­—æ®µ
     models: string[];
   }
   ```

2. **é”™è¯¯å¤„ç†æ”¹è¿›**  
   - ç»Ÿä¸€ç»§æ‰¿è‡ª `LLMError` åŸºç±»  
   - æ‰¹é‡éªŒè¯é”™è¯¯æ”¶é›†  
   ```ts
   class ValidationError extends LLMError {
     constructor(errors: string[]) {
       super(`é…ç½®éªŒè¯å¤±è´¥: ${errors.join(', ')}`);
     }
   }
   ```

### é…ç½®ç®¡ç†ï¼ˆ2024-03-21ï¼‰  
1. **æ¨¡å‹å¯ç”¨éªŒè¯**  
   ```ts
   function validateConfig(config) {
     if (!config.apiKey) {
       throw new Error("API Keyä¸ºå¿…å¡«é¡¹");
     }
   }
   ```

2. **ç¯å¢ƒå˜é‡å¤„ç†**  
   ```ts
   /// <reference types="vite/client" />
   interface ImportMetaEnv {
     VITE_GEMINI_KEY: string;
   }
   ```

### LLM æœåŠ¡é‡æ„ç»éªŒ

#### LangChain é›†æˆ
- æ—¥æœŸï¼š[å½“å‰æ—¥æœŸ]
- åœºæ™¯ï¼šå°†åŸç”Ÿ API è°ƒç”¨é‡æ„ä¸º LangChain å®ç°
- ä¸»è¦æ”¹è¿›ï¼š
  1. æ›´å¥½çš„å¯æ‰©å±•æ€§
  2. ç»Ÿä¸€çš„æ¥å£æŠ½è±¡
  3. å†…ç½®çš„é”™è¯¯å¤„ç†
  4. æ”¯æŒé«˜çº§ç‰¹æ€§

#### æœ€ä½³å®è·µ
1. ä½¿ç”¨æ¨¡å‹å®ä¾‹ç¼“å­˜æé«˜æ€§èƒ½
2. ç»Ÿä¸€æ¶ˆæ¯æ ¼å¼è½¬æ¢
3. ä¿æŒå…¬å…±æ¥å£ç¨³å®š
4. åˆ†å±‚é”™è¯¯å¤„ç†

#### æ³¨æ„äº‹é¡¹
1. éœ€è¦å®‰è£…ç›¸å…³ä¾èµ–ï¼š
   ```bash
   npm install langchain @langchain/core @langchain/openai @langchain/anthropic
   ```
2. ä¸åŒæ¨¡å‹æä¾›å•†çš„é…ç½®å‚æ•°å¯èƒ½ä¸åŒ
3. å»ºè®®ä½¿ç”¨ TypeScript è·å¾—æ›´å¥½çš„ç±»å‹æ”¯æŒ

#### æœªæ¥æ‰©å±•
1. æ”¯æŒæ›´å¤šæ¨¡å‹æä¾›å•†
2. æ·»åŠ é«˜çº§åŠŸèƒ½ï¼š
   - é“¾å¼è°ƒç”¨
   - ä»£ç†åŠŸèƒ½
   - å‘é‡å­˜å‚¨
   - è®°å¿†ç®¡ç†
3. æ€§èƒ½ä¼˜åŒ–ï¼š
   - å¹¶å‘è¯·æ±‚
   - æµå¼å“åº”
   - ç¼“å­˜ç­–ç•¥

---

## APIå¯†é’¥ç®¡ç†ç»éªŒ

### è®¾è®¡å†³ç­–
1. é‡‡ç”¨ç”¨æˆ·è‡ªç®¡ç†APIå¯†é’¥çš„æ–¹å¼
2. å¯ç”¨OpenAIåº“çš„æµè§ˆå™¨æ”¯æŒ
3. æä¾›å®Œæ•´çš„å¯†é’¥ç®¡ç†æŒ‡å¯¼

### åŸå› 
1. åº”ç”¨å®šä½ä¸ºä¸ªäººå·¥å…·
2. ç”¨æˆ·å¯ä»¥å®Œå…¨æ§åˆ¶è‡ªå·±çš„APIä½¿ç”¨
3. é¿å…åç«¯æœåŠ¡çš„å¼€é”€å’Œç»´æŠ¤
4. ä¿æŒåº”ç”¨çš„ç®€å•æ€§å’Œå¯ç§»æ¤æ€§

### å®‰å…¨è€ƒè™‘
1. å¯†é’¥ç”±ç”¨æˆ·è‡ªè¡Œåˆ›å»ºå’Œç®¡ç†
2. å»ºè®®ç”¨æˆ·ä¸ºåº”ç”¨å•ç‹¬åˆ›å»ºå¯†é’¥
3. æ¨èåœ¨OpenAIå¹³å°è®¾ç½®ä½¿ç”¨é™åˆ¶
4. æä¾›å¯†é’¥å®‰å…¨ä½¿ç”¨çš„æœ€ä½³å®è·µæŒ‡å¯¼

### ç”¨æˆ·ä½“éªŒä¼˜åŒ–
1. æä¾›è¯¦ç»†çš„APIå¯†é’¥è·å–æ•™ç¨‹
2. æ·»åŠ å¯†é’¥éªŒè¯åŠŸèƒ½
3. æ˜¾ç¤ºå½“å‰å¯†é’¥çš„ä½¿ç”¨çŠ¶æ€
4. æä¾›å¯†é’¥ä½¿ç”¨çš„å®‰å…¨æç¤º

### æŠ€æœ¯å®ç°
```typescript
const model = new OpenAI({
  apiKey: userProvidedKey,
  baseURL: modelConfig.baseURL,
  dangerouslyAllowBrowser: true // å¿…è¦çš„é…ç½®
});
```

### æœ€ä½³å®è·µå»ºè®®
1. åœ¨æœ¬åœ°å­˜å‚¨ä¸­åŠ å¯†ä¿å­˜å¯†é’¥
2. æä¾›æ¸…é™¤å¯†é’¥çš„åŠŸèƒ½
3. å®šæœŸæé†’ç”¨æˆ·æ£€æŸ¥å¯†é’¥ä½¿ç”¨æƒ…å†µ
4. æä¾›å¯†é’¥è½®æ¢çš„æŒ‡å¯¼

## æµ‹è¯•ä¿®å¤ç»éªŒæ€»ç»“

### 1. å¸¸è§æµ‹è¯•å¤±è´¥åŸå› 
- æ–¹æ³•åä¸åŒ¹é…ï¼šå®ç°å˜æ›´åæœªåŒæ­¥æ›´æ–°æµ‹è¯•ç”¨ä¾‹
- é”™è¯¯æ¶ˆæ¯ä¸ä¸€è‡´ï¼šæµ‹è¯•æœŸæœ›ä¸å®é™…å®ç°çš„é”™è¯¯æ¶ˆæ¯æ ¼å¼ä¸åŒ¹é…
- æ¨¡æ¿éªŒè¯é€»è¾‘ä¸ä¸€è‡´ï¼šæµ‹è¯•ç”¨ä¾‹æœªåæ˜ æœ€æ–°çš„ä¸šåŠ¡é€»è¾‘

### 2. ä¿®å¤ç­–ç•¥
- ç»Ÿä¸€é”™è¯¯æ¶ˆæ¯æ ¼å¼ï¼šç¡®ä¿æµ‹è¯•ç”¨ä¾‹ä¸å®é™…ä»£ç çš„é”™è¯¯æ¶ˆæ¯å®Œå…¨åŒ¹é…
- ç§»é™¤å¤šä½™çš„æ¨¡æ‹Ÿï¼šåˆ é™¤ä¸å¿…è¦çš„æ¨¡æ‹Ÿè°ƒç”¨
- æ·»åŠ ç¼ºå¤±çš„æ¨¡æ‹Ÿï¼šç¡®ä¿æ‰€æœ‰å¿…è¦çš„ä¾èµ–éƒ½è¢«æ­£ç¡®æ¨¡æ‹Ÿ

### 3. æœ€ä½³å®è·µ
- é”™è¯¯æ¶ˆæ¯ç®¡ç†ï¼šç»Ÿä¸€å®šä¹‰é”™è¯¯æ¶ˆæ¯ï¼Œé¿å…åˆ†æ•£ç®¡ç†
- æµ‹è¯•ç”¨ä¾‹ç»´æŠ¤ï¼šåŠæ—¶æ›´æ–°æµ‹è¯•ç”¨ä¾‹ä»¥åæ˜ æœ€æ–°çš„ä»£ç è¡Œä¸º
- Mock ç­–ç•¥ï¼šåªæ¨¡æ‹Ÿå¿…è¦çš„æ–¹æ³•ï¼Œé¿å…è¿‡åº¦æ¨¡æ‹Ÿ
- æµ‹è¯•è¦†ç›–ï¼šå…³æ³¨è¾¹ç•Œæ¡ä»¶å’Œå¼‚å¸¸åœºæ™¯çš„æµ‹è¯•

### 4. æ”¹è¿›å»ºè®®
- ä½¿ç”¨å¸¸é‡å®šä¹‰é”™è¯¯æ¶ˆæ¯
- å®Œå–„é”™è¯¯å¤„ç†çš„ç±»å‹å®šä¹‰
- æ·»åŠ æ›´å¤šè¾¹ç•Œæ¡ä»¶æµ‹è¯•
- åˆ›å»ºæµ‹è¯•è¾…åŠ©å‡½æ•°ç®€åŒ–é‡å¤è®¾ç½®

### 5. æµ‹è¯•ä»£ç ç¤ºä¾‹
```typescript
// é”™è¯¯æ¶ˆæ¯å¸¸é‡
const ERROR_MESSAGES = {
  TEMPLATE_NOT_FOUND: 'æ¨¡æ¿ä¸å­˜åœ¨æˆ–æ— æ•ˆ',
  MANAGER_NOT_INITIALIZED: 'æ¨¡æ¿ç®¡ç†å™¨æœªåˆå§‹åŒ–',
  MODEL_NOT_FOUND: 'æ¨¡å‹ä¸å­˜åœ¨'
} as const;

// æµ‹è¯•è¾…åŠ©å‡½æ•°
function setupMocks(options: {
  templateContent?: string,
  modelExists?: boolean,
  messageResult?: string
}) {
  const { templateContent, modelExists = true, messageResult } = options;
  
  if (modelExists) {
    vi.spyOn(modelManager, 'getModel').mockReturnValue(mockModelConfig);
  } else {
    vi.spyOn(modelManager, 'getModel').mockReturnValue(undefined);
  }
  
  if (templateContent !== undefined) {
    vi.spyOn(templateManager, 'getTemplate').mockResolvedValue({
      ...mockTemplate,
      template: templateContent
    });
  }
  
  if (messageResult) {
    vi.spyOn(llmService, 'sendMessage').mockResolvedValue(messageResult);
  }
}
```

### 6. æµ‹è¯•æ”¹è¿›ç»éªŒï¼ˆ2024-03-22ï¼‰

#### è¾¹ç•Œæ¡ä»¶æµ‹è¯•è¦ç‚¹
1. **è¾“å…¥éªŒè¯**
   - ç©ºå­—ç¬¦ä¸²å¤„ç†
   - è¶…é•¿è¾“å…¥å¤„ç†
   - ç‰¹æ®Šå­—ç¬¦å¤„ç†
   - æ— æ•ˆå‚æ•°å¤„ç†

2. **æœåŠ¡å¼‚å¸¸å¤„ç†**
   - è¶…æ—¶å¤„ç†
   - ç©ºå“åº”å¤„ç†
   - ç½‘ç»œé”™è¯¯å¤„ç†
   - æœåŠ¡é™çº§å¤„ç†

3. **çŠ¶æ€è®°å½•éªŒè¯**
   - å†å²è®°å½•å®Œæ•´æ€§
   - çŠ¶æ€å˜æ›´æ­£ç¡®æ€§
   - å…³è”å…³ç³»å‡†ç¡®æ€§
   - æ—¶åºè®°å½•å‡†ç¡®æ€§

#### æµ‹è¯•ä»£ç ç»„ç»‡
```typescript
describe('åŠŸèƒ½æµ‹è¯•ç»„', () => {
  // åŸºç¡€æµ‹è¯•
  describe('åŸºæœ¬åŠŸèƒ½', () => {
    it('æ­£å¸¸åœºæ™¯', async () => {});
    it('å¼‚å¸¸åœºæ™¯', async () => {});
  });

  // è¾¹ç•Œæ¡ä»¶
  describe('è¾¹ç•Œæ¡ä»¶', () => {
    it('ç©ºè¾“å…¥', async () => {});
    it('è¶…é•¿è¾“å…¥', async () => {});
    it('ç‰¹æ®Šå­—ç¬¦', async () => {});
  });

  // çŠ¶æ€ç®¡ç†
  describe('çŠ¶æ€ç®¡ç†', () => {
    it('çŠ¶æ€è®°å½•', async () => {});
    it('çŠ¶æ€æŸ¥è¯¢', async () => {});
    it('çŠ¶æ€å…³è”', async () => {});
  });
});
```

#### æµ‹è¯•ä¼˜åŒ–æŠ€å·§
1. **Mock ä¼˜åŒ–**
   ```typescript
   // ç»Ÿä¸€çš„ Mock è®¾ç½®
   function setupServiceMocks(options: MockOptions) {
     const {
       templateContent,
       modelResponse,
       shouldFail
     } = options;

     if (shouldFail) {
       vi.spyOn(service, 'call').mockRejectedValue(new Error('é¢„æœŸçš„é”™è¯¯'));
     } else {
       vi.spyOn(service, 'call').mockResolvedValue(modelResponse);
     }
   }
   ```

2. **é”™è¯¯å¤„ç†éªŒè¯**
   ```typescript
   // ç»Ÿä¸€çš„é”™è¯¯å¤„ç†éªŒè¯
   expect(() => {
     // è§¦å‘é”™è¯¯çš„æ“ä½œ
   }).rejects.toThrow(expect.objectContaining({
     name: 'ValidationError',
     message: expect.stringContaining('é¢„æœŸçš„é”™è¯¯æ¶ˆæ¯')
   }));
   ```

3. **æµ‹è¯•æ•°æ®ç®¡ç†**
   ```typescript
   // é›†ä¸­ç®¡ç†æµ‹è¯•æ•°æ®
   const TEST_DATA = {
     validPrompt: 'æœ‰æ•ˆçš„æç¤ºè¯',
     invalidPrompt: '',
     longPrompt: 'a'.repeat(10000),
     specialChars: '!@#$%^&*()',
   } as const;
   ```

#### æ”¹è¿›æ•ˆæœ
1. æµ‹è¯•è¦†ç›–ç‡æå‡
2. è¾¹ç•Œåœºæ™¯æ›´å®Œå–„
3. ä»£ç å¯ç»´æŠ¤æ€§æé«˜
4. æµ‹è¯•æ‰§è¡Œæ•ˆç‡æå‡

## LangChainæ¶ˆæ¯ç±»å‹ä¿®å¤ç»éªŒ

### é—®é¢˜æè¿°
åœ¨ä½¿ç”¨LangChainè¿›è¡Œæ¶ˆæ¯å¤„ç†æ—¶,é‡åˆ°ç±»å‹ä¸åŒ¹é…çš„é—®é¢˜:
```typescript
Argument of type 'AIMessage' is not assignable to parameter of type 'AIMessageChunk'
```

### åŸå› åˆ†æ
1. LangChainçš„æ¶ˆæ¯ç±»å‹æœ‰å¤šç§,åŒ…æ‹¬`AIMessage`å’Œ`AIMessageChunk`
2. `AIMessageChunk`æ˜¯ä¸“é—¨ç”¨äºæµå¼å“åº”çš„æ¶ˆæ¯ç±»å‹
3. åœ¨è°ƒç”¨`invoke`æ–¹æ³•æ—¶,è¿”å›ç±»å‹ä¸º`AIMessageChunk`

### è§£å†³æ–¹æ¡ˆ
1. å°†å¯¼å…¥è¯­å¥ä»`AIMessage`æ”¹ä¸º`AIMessageChunk`:
```typescript
import { AIMessageChunk } from '@langchain/core/messages'
```

2. æ›´æ–°æ‰€æœ‰ä½¿ç”¨`AIMessage`çš„åœ°æ–¹ä¸º`AIMessageChunk`

### æœ€ä½³å®è·µ
1. ä½¿ç”¨æ­£ç¡®çš„æ¶ˆæ¯ç±»å‹:
   - `AIMessage`: ç”¨äºæ™®é€šæ¶ˆæ¯
   - `AIMessageChunk`: ç”¨äºæµå¼å“åº”
   - `HumanMessage`: ç”¨äºç”¨æˆ·è¾“å…¥
   - `SystemMessage`: ç”¨äºç³»ç»Ÿæ¶ˆæ¯
2. åœ¨mockæµ‹è¯•æ—¶ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„æ¶ˆæ¯ç±»å‹
3. å‚è€ƒLangChainæ–‡æ¡£ä¸­çš„ç±»å‹å®šä¹‰

### ç›¸å…³æ–‡æ¡£
- [LangChainæ¶ˆæ¯ç±»å‹æ–‡æ¡£](https://js.langchain.com/docs/api/schema/messages)
- [LangChainæµå¼å“åº”æ–‡æ¡£](https://js.langchain.com/docs/modules/model_io/models/chat/streaming)

## è‡ªå®šä¹‰APIé›†æˆç»éªŒ

### é…ç½®è¦æ±‚
1. APIéœ€è¦æ”¯æŒOpenAIå…¼å®¹æ ¼å¼
2. å“åº”æ ¼å¼éœ€è¦ç¬¦åˆä»¥ä¸‹ç»“æ„ï¼š
```json
{
  "choices": [{
    "message": {
      "content": "APIå“åº”å†…å®¹"
    }
  }]
}
```

### ç¯å¢ƒå˜é‡é…ç½®
```env
# è‡ªå®šä¹‰APIé…ç½®
VITE_CUSTOM_API_KEY=æ‚¨çš„APIå¯†é’¥
VITE_CUSTOM_API_BASE_URL=æ‚¨çš„APIåŸºç¡€URL
```

### æœ€ä½³å®è·µ
1. åœ¨æ·»åŠ æ–°çš„APIæ—¶ï¼Œå…ˆè¿›è¡Œå…¼å®¹æ€§æµ‹è¯•
2. ç¡®ä¿é”™è¯¯å¤„ç†æœºåˆ¶å®Œå–„
3. æ·»åŠ å¿…è¦çš„è¯·æ±‚å¤´å’Œè®¤è¯ä¿¡æ¯
4. å®ç°è¯·æ±‚é‡è¯•æœºåˆ¶
5. åšå¥½æ—¥å¿—è®°å½•

### å¸¸è§é—®é¢˜
1. APIæ ¼å¼ä¸å…¼å®¹ï¼šç¡®ä¿å“åº”æ ¼å¼ç¬¦åˆOpenAIæ ‡å‡†
2. è®¤è¯å¤±è´¥ï¼šæ£€æŸ¥APIå¯†é’¥é…ç½®
3. è·¨åŸŸé—®é¢˜ï¼šé…ç½®æ­£ç¡®çš„CORSè®¾ç½®
4. è¶…æ—¶å¤„ç†ï¼šè®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´

## æµ‹è¯•ç»éªŒæ€»ç»“

### 1. æµ‹è¯•æ•°æ®ç®¡ç†
- æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹ä½¿ç”¨ç‹¬ç«‹çš„æµ‹è¯•æ•°æ®
- ä½¿ç”¨åŠ¨æ€ç”Ÿæˆçš„å”¯ä¸€æ ‡è¯†ç¬¦é¿å…å†²çª
- åœ¨æ·»åŠ æ–°æ•°æ®å‰ç¡®ä¿æ¸…ç†å·²å­˜åœ¨æ•°æ®

### 2. åˆå§‹åŒ–çŠ¶æ€ç®¡ç†
- æ³¨æ„å¯¹è±¡æ„é€ å‡½æ•°ä¸­çš„é»˜è®¤è¡Œä¸º
- ä¸èƒ½ä»…ä¾èµ– beforeEach çš„æ¸…ç†
- éœ€è¦æ‰‹åŠ¨å¤„ç†é»˜è®¤å€¼å’ŒæŒä¹…åŒ–æ•°æ®

### 3. å­˜å‚¨æœºåˆ¶å¤„ç†
- æ³¨æ„ localStorage ç­‰æŒä¹…åŒ–å­˜å‚¨çš„å½±å“
- ç¡®ä¿æ­£ç¡®æ¸…ç†æ‰€æœ‰ç›¸å…³çš„å­˜å‚¨æ•°æ®
- è€ƒè™‘ä½¿ç”¨ mock å­˜å‚¨æœºåˆ¶è¿›è¡Œæµ‹è¯•

### 4. æµ‹è¯•ç”¨ä¾‹éš”ç¦»
- æµ‹è¯•ç”¨ä¾‹ä¹‹é—´åº”è¯¥ç›¸äº’ç‹¬ç«‹
- æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹éƒ½åº”è¯¥å¯ä»¥ç‹¬ç«‹è¿è¡Œ
- é¿å…æµ‹è¯•ç”¨ä¾‹ä¹‹é—´çš„çŠ¶æ€ä¾èµ–

## æµ‹è¯•é‡æ„ç»éªŒï¼ˆ2024-03-22ï¼‰

### 1. æµ‹è¯•æ•°æ®éš”ç¦»çš„æœ€ä½³å®è·µ
- ä½¿ç”¨åŠ¨æ€ç”Ÿæˆçš„å”¯ä¸€æ ‡è¯†ç¬¦
- æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹ä½¿ç”¨ç‹¬ç«‹çš„æ•°æ®ç©ºé—´
- é¿å…æµ‹è¯•ç”¨ä¾‹ä¹‹é—´çš„çŠ¶æ€ä¾èµ–

### 2. æµ‹è¯•è¾…åŠ©å‡½æ•°è®¾è®¡
```typescript
// ç¤ºä¾‹ï¼šåˆ›å»ºå”¯ä¸€æ ‡è¯†ç¬¦
const getUniqueKey = (prefix: string) => `${prefix}-${Date.now()}`;

// ç¤ºä¾‹ï¼šåˆ›å»ºåŸºç¡€é…ç½®
const createBaseConfig = (options?: Partial<Config>) => ({
  ...defaultConfig,
  ...options
});
```

### 3. æµ‹è¯•ä»£ç ç»„ç»‡
- å°†é€šç”¨é€»è¾‘æŠ½å–ä¸ºè¾…åŠ©å‡½æ•°
- ä½¿ç”¨ beforeEach è¿›è¡ŒçŠ¶æ€åˆå§‹åŒ–
- ä¿æŒæµ‹è¯•ç”¨ä¾‹çš„ç‹¬ç«‹æ€§å’Œå¯è¯»æ€§

### 4. é…ç½®ç®¡ç†ä¼˜åŒ–
- é›†ä¸­ç®¡ç†æµ‹è¯•é…ç½®
- æ”¯æŒé…ç½®çš„éƒ¨åˆ†è¦†ç›–
- ä¾¿äºç»Ÿä¸€ä¿®æ”¹å’Œç»´æŠ¤

### 5. æ”¹è¿›æ•ˆæœ
- æé«˜äº†æµ‹è¯•çš„å¯é æ€§
- å‡å°‘äº†ä»£ç é‡å¤
- ç®€åŒ–äº†æµ‹è¯•ç»´æŠ¤
- æå‡äº†æµ‹è¯•æ‰§è¡Œæ•ˆç‡

## å¼€å‘ç»éªŒæ€»ç»“

## æµå¼å¤„ç†æœ€ä½³å®è·µ

### 1. ç»Ÿä¸€ä½¿ç”¨æµå¼API
- é¿å…ä½¿ç”¨éæµå¼API
- ä¸æä¾›é™çº§æ–¹æ¡ˆ
- ç¡®ä¿æ‰€æœ‰æ“ä½œéƒ½æ”¯æŒæµå¼å¤„ç†

### 2. æµå¼å¤„ç†å™¨è®¾è®¡
```typescript
// æ ‡å‡†æµå¼å¤„ç†å™¨ç»“æ„
interface StreamHandlers {
  onToken: (token: string) => void;   // å¤„ç†æ¯ä¸ªtoken
  onComplete: () => void;             // å¤„ç†å®Œæˆå›è°ƒ
  onError: (error: Error) => void;    // å¤„ç†é”™è¯¯
}

// ä½¿ç”¨ç¤ºä¾‹
const streamHandlers = {
  onToken: (token) => {
    result.value += token;  // å®æ—¶æ›´æ–°UI
  },
  onComplete: () => {
    isLoading.value = false;
    toast.success('å¤„ç†å®Œæˆ');
  },
  onError: (error) => {
    isLoading.value = false;
    toast.error(error.message);
  }
};
```

### 3. é”™è¯¯å¤„ç†
- å®æ—¶æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
- ä¿æŒUIçŠ¶æ€åŒæ­¥
- æä¾›å‹å¥½çš„é”™è¯¯æç¤º

### 4. çŠ¶æ€ç®¡ç†
- ä½¿ç”¨å“åº”å¼å˜é‡
- å®æ—¶æ›´æ–°å¤„ç†çŠ¶æ€
- æ­£ç¡®å¤„ç†åŠ è½½çŠ¶æ€

### 5. æ€§èƒ½ä¼˜åŒ–
- é¿å…é¢‘ç¹çš„DOMæ›´æ–°
- ä½¿ç”¨é˜²æŠ–å¤„ç†ç”¨æˆ·è¾“å…¥
- åˆç†è®¾ç½®ç¼“å†²åŒºå¤§å°

### 6. ç”¨æˆ·ä½“éªŒ
- æ˜¾ç¤ºå®æ—¶å¤„ç†è¿›åº¦
- æä¾›å–æ¶ˆå¤„ç†é€‰é¡¹
- ä¿æŒç•Œé¢å“åº”æ€§

## æ³¨æ„äº‹é¡¹
1. ç¡®ä¿æ‰€æœ‰APIéƒ½æ”¯æŒæµå¼å¤„ç†
2. å¤„ç†ç½‘ç»œå¼‚å¸¸æƒ…å†µ
3. åˆç†ç®¡ç†å†…å­˜ä½¿ç”¨
4. ä¿æŒä»£ç å¯ç»´æŠ¤æ€§

## æœ€ä½³å®è·µç¤ºä¾‹
```typescript
// 1. å®šä¹‰å¤„ç†å™¨
const createStreamHandlers = (options: {
  onUpdate: (text: string) => void,
  onSuccess: () => void,
  onError: (error: Error) => void
}) => ({
  onToken: (token: string) => {
    options.onUpdate(token);
  },
  onComplete: () => {
    options.onSuccess();
  },
  onError: (error: Error) => {
    options.onError(error);
  }
});

// 2. ä½¿ç”¨å¤„ç†å™¨
const handleStream = async () => {
  const handlers = createStreamHandlers({
    onUpdate: (text) => {
      result.value += text;
    },
    onSuccess: () => {
      toast.success('å¤„ç†å®Œæˆ');
    },
    onError: (error) => {
      toast.error(error.message);
    }
  });

  await service.processStream(input, handlers);
};
```